---
description: >
  Job to generate a schema report for a database, using schemaspy.
executor:
  name: default
  tag: "3.10"
parameters:
  host:
    type: string
    default: localhost
    description: Host name of the database.
  port:
    type: string
    default: 5432
    description: Port number of the database.
  database:
    type: string
    default: postgres
    description: Database type e.g. postgres
  schema:
    type: string
    description: Schema name.
  user:
    type: string
    default: root
    description: Database user name.
  password:
    type: string
    default: dev
    description: Database password.
  output:
    type: string
    default: /schemaspy
    description: Output directory.
steps:
  - checkout
  - run:
      name: Install schemaspy
      command: curl -L https://github.com/schemaspy/schemaspy/releases/download/v6.2.4/schemaspy-6.2.4.jar --output /tmp/schemaspy.jar
  - run:
      name: Generate database schema report
      command: |
        java -jar /tmp/schemaspy.jar \
          -t pgsql \
          -db << parameters.database >> \
          -host << parameters.host >> \
          -port << parameters.port >> \
          -s << parameters.schema >> \
          -u << parameters.user >> \
          -p << parameters.password >> \
          -o << parameters.output >>
  - store_artifacts:
      path: /schemaspy/output
      destination: schema
