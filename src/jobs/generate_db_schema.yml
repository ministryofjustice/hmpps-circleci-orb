---
description: >
  Job to generate a schema report for a database, using schemaspy.
executor:
  name: java
  tag: "21.0"
parameters:
  host:
    type: string
    default: localhost
    description: Host name of the database.
  port:
    type: string
    default: 5432
    description: Port number of the database.
  database:
    type: string
    default: postgres
    description: Database type e.g. postgres
  schema:
    type: string
    description: Schema name.
  user:
    type: string
    default: root
    description: Database user name.
  password:
    type: string
    default: dev
    description: Database password.
steps:
  - checkout
  - run:
      name: Install schemaspy
      command: curl -L https://github.com/schemaspy/schemaspy/releases/download/v6.2.4/schemaspy-6.2.4.jar --output /tmp/schemaspy.jar
  - run:
      name: Install postgres jdbc driver
      command: curl -L https://jdbc.postgresql.org/download/postgresql-42.7.3.jar --output /tmp/postgres-driver.jar
  - run:
      name: Generate database schema report
      command: |
        java -jar /tmp/schemaspy.jar \
          -t pgsql \
          -dp /tmp/postgres-driver.jar \
          -db << parameters.database >> \
          -host << parameters.host >> \
          -port << parameters.port >> \
          -s << parameters.schema >> \
          -vizjs \
          -u << parameters.user >> \
          -p << parameters.password >> \
          -o /tmp/schemaspy
  - store_artifacts:
      path: /tmp/schemaspy
      destination: schema
